<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miniservice Ranchito's - Gestión Web</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bg-custom-purple {
            background-color: #6D63B8; 
            background-image: repeating-linear-gradient(
                -45deg,
                rgba(255, 255, 255, 0.05) 0,
                rgba(255, 255, 255, 0.05) 1px,
                transparent 1px,
                transparent 15px 
            );
            background-size: 30px 30px; 
        }
        
        .login-box-container {
            width: 80%; 
            max-width: 450px; 
        }

        .error-message {
            background-color: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex w-full min-h-screen">
        <!-- Imagen del minimarket -->
        <div class="hidden lg:block lg:w-1/2">
            <img 
                src="image/foto.jpeg" 
                alt="Fachada de Miniservice Ranchito's" 
                class="w-full h-full object-cover"
            >
        </div>

        <!-- Formulario de login -->
        <div class="w-full lg:w-1/2 bg-custom-purple flex items-center justify-center p-8">
            <div class="bg-white login-box-container p-12 lg:p-16 h-4/5 flex flex-col justify-center rounded-lg shadow-xl">
                
                <!-- Header -->
                <div class="text-center mb-8">
                    <p class="text-sm font-semibold text-gray-700 flex items-center justify-center gap-1">
                        <svg class="w-4 h-4 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        Miniservice Ranchito's
                    </p>
                    
                    <h2 class="text-3xl font-bold text-gray-800 border-b-2 border-gray-800 inline-block pb-1 mt-1">
                        Gestionamiento web
                    </h2>
                </div>

                <p class="text-center text-gray-600 mb-8 text-lg">
                    Por favor, inicie sesión para ingresar
                </p>

                <!-- Mensaje de error -->
                <div id="errorMessage" class="error-message"></div>

                <!-- Formulario de login -->
                <form id="loginForm">
                    <div class="space-y-6">
                        <div>
                            <input 
                                type="text" 
                                id="usuario" 
                                name="usuario" 
                                placeholder="Usuario" 
                                class="w-full px-5 py-3 border border-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg"
                                required
                                autocomplete="username"
                            >
                        </div>
                        
                        <div>
                            <input 
                                type="password" 
                                id="contraseña" 
                                name="contraseña" 
                                placeholder="Contraseña" 
                                class="w-full px-5 py-3 border border-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg"
                                required
                                autocomplete="current-password"
                            >
                        </div>
                    </div>

                    <div class="mt-8">
                        <button 
                            type="submit" 
                            id="loginButton"
                            class="w-full text-white font-semibold py-3 rounded-lg transition duration-300 ease-in-out shadow-md text-lg"
                            style="background-color: #6D63B8;"
                        >
                            Iniciar sesión
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Script de autenticación -->
    <script type="module">
        // Configuración de la API
        const API_URL = 'http://localhost:5000/api';

        // Obtener elementos del DOM
        const loginForm = document.getElementById('loginForm');
        const loginButton = document.getElementById('loginButton');
        const errorMessage = document.getElementById('errorMessage');

        // Función para mostrar error
        function mostrarError(mensaje) {
            errorMessage.textContent = mensaje;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        // Función de login
        async function handleLogin(nombreUsuario, contrasena) {
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ nombreUsuario, contrasena })
                });

                const data = await response.json();

                if (data.success) {
                    // Guardar token y datos de usuario
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('usuario', JSON.stringify(data.usuario));

                    // Mostrar éxito
                    loginButton.textContent = '¡Éxito! Redirigiendo...';
                    loginButton.style.backgroundColor = '#10B981';

                    // Redirigir al dashboard
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1000);

                } else {
                    mostrarError(data.message || 'Error al iniciar sesión');
                    loginButton.textContent = 'Iniciar sesión';
                    loginButton.classList.remove('loading');
                }

            } catch (error) {
                console.error('Error de conexión:', error);
                mostrarError('Error de conexión. Verifique que el backend esté corriendo en localhost:5000');
                loginButton.textContent = 'Iniciar sesión';
                loginButton.classList.remove('loading');
            }
        }

        // Manejar el envío del formulario
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const nombreUsuario = document.getElementById('usuario').value.trim();
            const contrasena = document.getElementById('contraseña').value;

            if (!nombreUsuario || !contrasena) {
                mostrarError('Por favor complete todos los campos');
                return;
            }

            // Mostrar estado de carga
            loginButton.textContent = 'Iniciando sesión...';
            loginButton.classList.add('loading');

            // Ejecutar login
            await handleLogin(nombreUsuario, contrasena);
        });

        // Verificar si ya hay sesión activa
        window.addEventListener('load', () => {
            const token = localStorage.getItem('token');
            const usuario = localStorage.getItem('usuario');

            if (token && usuario) {
                // Ya hay sesión, redirigir al dashboard
                window.location.href = 'index.html';
            }
        });
    </script>
</body>
</html>